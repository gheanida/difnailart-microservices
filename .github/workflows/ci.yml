# .github/workflows/ci.yml
name: Microservices CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:
  workflow_call:

jobs:
  validate-structure:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: echo "Validating structure..."

  user-service:
    name: User Service
    needs: validate-structure
    uses: ./.github/workflows/user-service-ci.yml  # <-- Tambah titik di depan
    secrets: inherit

  booking-service:
    name: Booking Service
    needs: validate-structure
    uses: ./.github/workflows/booking-service-ci.yml  # <-- Tambah titik di depan
    secrets: inherit

  frontend:
    name: Frontend
    needs: validate-structure
    uses: ./.github/workflows/frontend-ci.yml  
    secrets: inherit

  integration-test:
    name: Integration Tests
    needs: [user-service, booking-service, frontend]
    runs-on: ubuntu-latest
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Start services with Docker Compose
        run: |
          docker-compose up -d --build
          sleep 30 # Wait for services to start
      
      - name: Check running services
        run: docker ps
